/*! asa-swim-time-scraper 2017 - 08 - 02  */

!function(){"use strict";var e=require("./scraper.js").scrapeSite,t=require("eyes").inspector({maxLength:!1});console.debug=function(){};var r={getTimes:function(r){return new Promise(function(s,a){r.match(/[0-9]/i)||a("ERR: Not a ASA Number");var i=(new Date).getFullYear().toString();e("https://www.swimmingresults.org/individualbest/personal_best.php?&targetyear="+i+"&tiref="+r+"&mode=A").then(function(e){console.debug("got my result, size is "+e.length),t(e),s(e)}).catch(function(e){a("ERR: Error getting site times: ",e)})})}};module.exports=r}(),function(){"use strict";var e=require("cheerio"),t=require("cheerio-tableparser"),r=require("request"),s=require("./strokeList"),a=require("eyes").inspector({maxLength:!1}),i=require("moment"),o=require("asa-swim-time-converter").getTime;process.env.NODE_TLS_REJECT_UNAUTHORIZED="0";var n={scrapeSite:function(n){return new Promise(function(l,u){r(n,function(r,n,c){r&&u(r),200!==n.statusCode&&u("Invalid status code: "+n.statusCode);for(var d=e.load(c),m=d("table#rankTable"),g=[],v=0;v<m.length;v+=1){var y=m.get(v);t(d);var f=d(y).parsetable(!0,!0,!0);a(f);for(var b=0===v?"LC":"SC",k=0===v?"50m":"25m",p=0===v?"25m":"50m",F=0===v?"SC":"LC",B="",M=0;M<f[0].length;M+=1)if(M>0){B=null===s[f[0][M]]?f[0][M]:s[f[0][M]],console.debug("1.....",f[0][M]),console.debug("2.....",s[f[0][M]]),console.debug("3.....",B);var h={course:b,stroke:B,dataObtained:i(f[3][M],"DD/MM/YY").toDate(),timeDate:[{course:b,timing:f[1][M],dateAndTime:i(f[3][M]+"-"+f[1][M],"DD/MM/YY-mm:ss.SSS").toObject(),calculated:!1},{course:F,timing:"100 IM"!==B?o(B,k,p,f[1][M]):f[1][M],dateAndTime:i("100 IM"!==B?f[3][M]+"-"+o(B,k,p,f[1][M]):f[3][M]+"-"+f[1][M],"DD/MM/YY-mm:ss.SSS").toObject(),calculated:!0}],finaPts:f[2][M],meet:f[4][M],venue:f[5][M],license:f[6][M],level:f[7][M],dateCollected:new Date};g.push(h)}}l(g)})})}};module.exports=n}();var strokeTable={"50 Freestyle":"50 Free","100 Freestyle":"100 Free","200 Freestyle":"200 Free","400 Freestyle":"400 Free","800 Freestyle":"800 Free","1500 Freestyle":"1500 Free","50 Breaststroke":"50 Breast","100 Breaststroke":"100 Breast","200 Breaststroke":"200 Breast","50 Butterfly":"50 Fly","100 Butterfly":"100 Fly","200 Butterfly":"200 Fly","50 Backstroke":"50 Back","100 Backstroke":"100 Back","200 Backstroke":"200 Back","100 Individual Medley":"100 IM","200 Individual Medley":"200 IM","400 Individual Medley":"400 IM"};module.exports=strokeTable;