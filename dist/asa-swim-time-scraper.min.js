/*! asa-swim-time-scraper 2017 - 08 - 02  */

!function(){"use strict";var e=require("./scraper.js").scrapeSite;console.debug=function(){};var t={getTimes:function(t){return new Promise(function(r,s){t.match(/[0-9]/i)||s("ERR: Not a ASA Number");var a=(new Date).getFullYear().toString();e("https://www.swimmingresults.org/individualbest/personal_best.php?&targetyear="+a+"&tiref="+t+"&mode=A").then(function(e){console.debug("got my result, size is "+e.length),r(e)}).catch(function(e){s("ERR: Error getting site times: ",e)})})}};module.exports=t}(),function(){"use strict";var e=require("cheerio"),t=require("cheerio-tableparser"),r=require("request"),s=require("./strokeList"),a=require("moment"),o=require("asa-swim-time-converter").getTime;process.env.NODE_TLS_REJECT_UNAUTHORIZED="0";var i={scrapeSite:function(i){return new Promise(function(n,l){r(i,function(r,i,u){r&&l(r),200!==i.statusCode&&l("Invalid status code: "+i.statusCode);for(var c=e.load(u),d=c("table#rankTable"),m=[],g=0;g<d.length;g+=1){var v=d.get(g);t(c);for(var f=c(v).parsetable(!0,!0,!0),b=0===g?"LC":"SC",k=0===g?"50m":"25m",y=0===g?"25m":"50m",F=0===g?"SC":"LC",B="",p=0;p<f[0].length;p+=1)if(p>0){B=null===s[f[0][p]]?f[0][p]:s[f[0][p]],console.debug("1.....",f[0][p]),console.debug("2.....",s[f[0][p]]),console.debug("3.....",B);var M={course:b,stroke:B,dataObtained:a(f[3][p],"DD/MM/YY").toDate(),timeDate:[{course:b,timing:f[1][p],dateAndTime:a(f[3][p]+"-"+f[1][p],"DD/MM/YY-mm:ss.SSS").toObject(),calculated:!1},{course:F,timing:"100 IM"!==B?o(B,k,y,f[1][p]):f[1][p],dateAndTime:a("100 IM"!==B?f[3][p]+"-"+o(B,k,y,f[1][p]):f[3][p]+"-"+f[1][p],"DD/MM/YY-mm:ss.SSS").toObject(),calculated:!0}],finaPts:f[2][p],meet:f[4][p],venue:f[5][p],license:f[6][p],level:f[7][p],dateCollected:new Date};m.push(M)}}n(m)})})}};module.exports=i}();var strokeTable={"50 Freestyle":"50 Free","100 Freestyle":"100 Free","200 Freestyle":"200 Free","400 Freestyle":"400 Free","800 Freestyle":"800 Free","1500 Freestyle":"1500 Free","50 Breaststroke":"50 Breast","100 Breaststroke":"100 Breast","200 Breaststroke":"200 Breast","50 Butterfly":"50 Fly","100 Butterfly":"100 Fly","200 Butterfly":"200 Fly","50 Backstroke":"50 Back","100 Backstroke":"100 Back","200 Backstroke":"200 Back","100 Individual Medley":"100 IM","200 Individual Medley":"200 IM","400 Individual Medley":"400 IM"};module.exports=strokeTable;